/*
 * config.c
 *
 *  Created on: 7 мар. 2022 г.
 *      Author: VHEMaster
 */

#include "config.h"
#include "structs.h"
#include "flash.h"
#include "defines.h"

#include <stdio.h>
#include <string.h>
#include <math.h>

#define CONFIG_OFFSET_PARAMS (0)
#define CONFIG_OFFSET_CORRECTIONS (CONFIG_OFFSET_PARAMS + 1)
#define CONFIG_OFFSET_TABLES (CONFIG_OFFSET_CORRECTIONS + 1)

#define CONFIG_OFFSET_CRITICALS 1920

static const float default_cylinders[ECU_CYLINDERS_COUNT] = {
    1, 2, 3, 4
};

static const float default_pressures[TABLE_PRESSURES_MAX] = {
    10000, 16200, 22400, 28600, 34800, 41000, 47200, 53400,
    59600, 65800, 72000, 78200, 84400, 90600, 96800, 103000
};

static const float default_idle_rotates[TABLE_ROTATES_MAX] = {
    525, 556, 588, 625, 667, 714, 769, 833,
    909, 1000, 1111, 1250, 1429, 1667, 2000, 2500,
};

static const float default_rotates[TABLE_ROTATES_MAX] = {
    600, 740, 870, 1050, 1250, 1490, 1800, 2150,
    2560, 3040, 3590, 4310, 5100, 6060, 7190, 8500
};

static const float default_throttles[TABLE_THROTTLES_MAX] = {
    0.0f, 1.73f, 3.47f, 5.65f, 8.26f, 11.30f, 15.22f, 19.56f,
    24.78f, 30.87f, 37.83f, 46.96f, 56.96f, 69.13f, 83.48f, 100.0f
};

static const float default_pedals[TABLE_PEDALS_MAX] = {
    0.0f, 1.73f, 3.47f, 5.65f, 8.26f, 11.30f, 15.22f, 19.56f,
    24.78f, 30.87f, 37.83f, 46.96f, 56.96f, 69.13f, 83.48f, 100.0f
};

static const float default_fillings[TABLE_FILLING_MAX] = {
    33, 65, 98, 130, 163, 195, 228, 260,
    293, 325, 358, 390, 423, 455, 488, 520,
};

static const float default_filling_select_koff_tps[TABLE_FILLING_MAX] = {
    0.00f, 0.00f, 0.00f, 0.00f, 0.00f, 0.00f, 0.00f, 0.00f,
    0.00f, 0.00f, 0.00f, 0.00f, 0.00f, 0.00f, 0.00f, 0.00f,
};

static const float default_filling_gbc_map[TABLE_PRESSURES_MAX][TABLE_ROTATES_MAX] = {
    { 0.0630f, 0.0618f, 0.0617f, 0.0616f, 0.0617f, 0.0623f, 0.0641f, 0.0733f, 0.0737f, 0.0723f, 0.1202f, 0.1042f, 0.0727f, 0.0756f, 0.0720f, 0.0720f, },
    { 0.1009f, 0.1007f, 0.1003f, 0.1000f, 0.1000f, 0.1009f, 0.1035f, 0.1208f, 0.0847f, 0.2082f, 0.0493f, 0.0003f, 0.0003f, 0.0941f, 0.1171f, 0.0917f, },
    { 0.0976f, 0.0973f, 0.0966f, 0.0959f, 0.0958f, 0.0971f, 0.1243f, 0.2682f, 0.1938f, 0.0314f, 0.0293f, 0.0384f, 0.0751f, 0.0856f, 0.1383f, 0.1230f, },
    { 0.1258f, 0.1251f, 0.1241f, 0.1232f, 0.1257f, 0.1303f, 0.0000f, 0.1094f, 0.0921f, 0.0777f, 0.1123f, 0.2030f, 0.1394f, 0.1193f, 0.1799f, 0.1641f, },
    { 0.1548f, 0.1541f, 0.1534f, 0.1535f, 0.1545f, 0.2069f, 0.1221f, 0.1314f, 0.1058f, 0.1161f, 0.1547f, 0.1770f, 0.1978f, 0.1789f, 0.2166f, 0.2000f, },
    { 0.1852f, 0.2656f, 0.1856f, 0.1890f, 0.2426f, 0.1695f, 0.1452f, 0.1573f, 0.1571f, 0.1568f, 0.2057f, 0.2546f, 0.2543f, 0.2247f, 0.2421f, 0.2155f, },
    { 0.2216f, 0.2385f, 0.2441f, 0.2421f, 0.1875f, 0.1876f, 0.1732f, 0.2206f, 0.2195f, 0.2276f, 0.2596f, 0.3076f, 0.2982f, 0.2923f, 0.3175f, 0.2535f, },
    { 0.4028f, 0.3571f, 0.3424f, 0.2970f, 0.2058f, 0.2413f, 0.2304f, 0.2725f, 0.2722f, 0.2646f, 0.3282f, 0.3961f, 0.3777f, 0.3399f, 0.3576f, 0.3367f, },
    { 0.4629f, 0.2334f, 0.3155f, 0.2711f, 0.2397f, 0.3070f, 0.2788f, 0.3375f, 0.3036f, 0.3205f, 0.3904f, 0.4332f, 0.4363f, 0.3672f, 0.4233f, 0.4001f, },
    { 0.3996f, 0.2870f, 0.3486f, 0.2775f, 0.2874f, 0.3662f, 0.3250f, 0.3804f, 0.3636f, 0.3745f, 0.4739f, 0.4795f, 0.5010f, 0.4332f, 0.5432f, 0.5831f, },
    { 0.6591f, 0.3069f, 0.2981f, 0.3043f, 0.3448f, 0.3849f, 0.3752f, 0.4386f, 0.4114f, 0.4737f, 0.5328f, 0.5297f, 0.5654f, 0.5123f, 0.5945f, 0.6428f, },
    { 0.8394f, 0.3250f, 0.4012f, 0.4368f, 0.3873f, 0.4325f, 0.4327f, 0.5105f, 0.4534f, 0.5373f, 0.5844f, 0.6356f, 0.6182f, 0.6050f, 0.5537f, 0.6633f, },
    { 0.9058f, 0.4016f, 0.4579f, 0.3785f, 0.4773f, 0.4816f, 0.5116f, 0.5533f, 0.5479f, 0.5971f, 0.6459f, 0.7069f, 0.6854f, 0.6584f, 0.6342f, 0.7433f, },
    { 1.0014f, 0.7463f, 0.6716f, 0.5140f, 0.5329f, 0.5809f, 0.5596f, 0.6210f, 0.5915f, 0.6715f, 0.7347f, 0.7766f, 0.7722f, 0.7394f, 0.6817f, 0.7922f, },
    { 0.8095f, 0.8516f, 0.6283f, 0.4850f, 0.5802f, 0.6154f, 0.6070f, 0.7129f, 0.6361f, 0.7479f, 0.8034f, 0.8525f, 0.8681f, 0.8230f, 0.7686f, 0.7905f, },
    { 0.9341f, 0.9662f, 0.8227f, 0.7917f, 0.7908f, 0.7980f, 0.7020f, 0.7355f, 0.8476f, 0.8688f, 0.9177f, 0.9330f, 0.9659f, 0.8647f, 0.8444f, 0.8272f, },
};

static const float default_filling_gbc_tps[TABLE_THROTTLES_MAX][TABLE_ROTATES_MAX] = {
    { 0.5186f, 0.3679f, 0.3370f, 0.2421f, 0.2151f, 0.2013f, 0.0348f, 0.2959f, 0.1818f, 0.2116f, 0.1050f, 0.0723f, 0.0553f, 0.0863f, 0.0210f, 0.0170f, },
    { 0.5869f, 0.4980f, 0.4453f, 0.3859f, 0.3487f, 0.2453f, 0.0727f, 0.0580f, 0.2138f, 0.1524f, 0.1561f, 0.0372f, 0.0909f, 0.1351f, 0.0141f, 0.0270f, },
    { 0.6296f, 0.5033f, 0.3940f, 0.2894f, 0.2427f, 0.1889f, 0.1456f, 0.1278f, 0.0952f, 0.0871f, 0.0402f, 0.0169f, 0.0130f, 0.1122f, 0.0345f, 0.0360f, },
    { 0.6645f, 0.6242f, 0.4273f, 0.3505f, 0.3142f, 0.2765f, 0.2298f, 0.1571f, 0.1616f, 0.1152f, 0.0868f, 0.0072f, 0.0310f, 0.1162f, 0.0235f, 0.0330f, },
    { 0.7378f, 0.6550f, 0.5343f, 0.4449f, 0.4105f, 0.4047f, 0.3388f, 0.2817f, 0.2381f, 0.1761f, 0.1552f, 0.0972f, 0.0968f, 0.1288f, 0.0688f, 0.0630f, },
    { 0.6402f, 0.6076f, 0.6368f, 0.5181f, 0.5116f, 0.4712f, 0.4309f, 0.3977f, 0.3388f, 0.3093f, 0.2201f, 0.2036f, 0.0969f, 0.0297f, 0.0928f, 0.0770f, },
    { 0.5980f, 0.6020f, 0.5769f, 0.5781f, 0.6049f, 0.5375f, 0.5132f, 0.5155f, 0.4560f, 0.4540f, 0.3832f, 0.2710f, 0.2121f, 0.1521f, 0.1265f, 0.1136f, },
    { 0.6000f, 0.6010f, 0.6016f, 0.6158f, 0.7060f, 0.5829f, 0.5806f, 0.6115f, 0.5612f, 0.5812f, 0.5115f, 0.4435f, 0.3664f, 0.2902f, 0.2491f, 0.2278f, },
    { 0.6450f, 0.6120f, 0.6123f, 0.6077f, 0.6439f, 0.6737f, 0.6324f, 0.6693f, 0.6325f, 0.6862f, 0.6684f, 0.6000f, 0.5485f, 0.4666f, 0.4213f, 0.3900f, },
    { 0.7000f, 0.6470f, 0.5700f, 0.5790f, 0.6136f, 0.6774f, 0.6217f, 0.7073f, 0.6751f, 0.7462f, 0.7511f, 0.7367f, 0.6578f, 0.6091f, 0.5659f, 0.5082f, },
    { 0.7390f, 0.7000f, 0.5990f, 0.5940f, 0.6166f, 0.6717f, 0.6086f, 0.7296f, 0.7306f, 0.8032f, 0.8176f, 0.8077f, 0.7863f, 0.7177f, 0.6528f, 0.6344f, },
    { 0.7390f, 0.7000f, 0.6420f, 0.6640f, 0.6713f, 0.7089f, 0.6540f, 0.7232f, 0.7508f, 0.8080f, 0.8380f, 0.8518f, 0.8538f, 0.7920f, 0.7485f, 0.7336f, },
    { 0.7390f, 0.7400f, 0.7000f, 0.6940f, 0.7202f, 0.6903f, 0.6617f, 0.7366f, 0.7699f, 0.8148f, 0.8670f, 0.8715f, 0.8742f, 0.8129f, 0.7714f, 0.7737f, },
    { 0.7390f, 0.7580f, 0.7480f, 0.7380f, 0.7518f, 0.7293f, 0.6577f, 0.7208f, 0.7688f, 0.8225f, 0.8801f, 0.8748f, 0.8894f, 0.8100f, 0.7970f, 0.7813f, },
    { 0.7390f, 0.7760f, 0.7800f, 0.7620f, 0.7638f, 0.7192f, 0.6734f, 0.7326f, 0.7841f, 0.8136f, 0.8668f, 0.8733f, 0.9052f, 0.8414f, 0.8070f, 0.7951f, },
    { 0.7510f, 0.7800f, 0.7800f, 0.7800f, 0.7831f, 0.7514f, 0.6828f, 0.7114f, 0.7804f, 0.8197f, 0.8694f, 0.8746f, 0.8958f, 0.8369f, 0.8040f, 0.7719f, },
};

static const float default_throttle_position[TABLE_PEDALS_MAX][TABLE_ROTATES_MAX] = {
    { 0.0f, 0.0f, 0.0f, 0.9f, 3.2f, 5.5f, 8.7f, 11.9f, 15.9f, 21.1f, 24.3f, 31.3f, 37.9f, 42.9f, 44.0f, 46.8f, },
    { 0.0f, 0.0f, 0.0f, 0.9f, 3.2f, 5.5f, 8.7f, 11.9f, 15.9f, 21.1f, 24.8f, 32.3f, 39.5f, 44.0f, 46.0f, 49.0f, },
    { 0.0f, 0.0f, 0.0f, 0.9f, 3.2f, 5.5f, 8.7f, 11.9f, 15.9f, 21.1f, 25.7f, 33.4f, 40.9f, 45.1f, 49.3f, 50.9f, },
    { 0.0f, 0.0f, 0.0f, 0.9f, 3.2f, 5.5f, 8.7f, 11.9f, 15.9f, 21.0f, 26.2f, 34.3f, 42.2f, 47.0f, 50.8f, 53.9f, },
    { 0.0f, 0.0f, 0.0f, 0.9f, 3.2f, 5.5f, 8.7f, 11.9f, 15.9f, 21.0f, 26.7f, 35.4f, 44.0f, 48.7f, 53.3f, 54.3f, },
    { 0.0f, 0.0f, 0.0f, 0.9f, 3.2f, 5.5f, 8.7f, 11.9f, 15.9f, 21.1f, 27.3f, 36.2f, 45.3f, 51.2f, 56.6f, 58.8f, },
    { 0.0f, 0.0f, 0.0f, 1.4f, 3.2f, 5.5f, 8.7f, 11.9f, 15.9f, 21.1f, 28.0f, 36.7f, 47.1f, 53.6f, 59.6f, 63.9f, },
    { 0.0f, 0.0f, 0.8f, 1.9f, 3.7f, 6.0f, 8.7f, 11.9f, 15.9f, 21.2f, 28.2f, 37.2f, 48.0f, 56.6f, 63.0f, 68.9f, },
    { 0.0f, 0.0f, 0.8f, 1.9f, 3.7f, 6.0f, 8.7f, 11.9f, 16.0f, 21.3f, 28.3f, 38.7f, 49.1f, 59.3f, 69.0f, 76.5f, },
    { 0.0f, 0.0f, 0.8f, 1.9f, 3.7f, 6.0f, 8.7f, 11.9f, 16.0f, 21.3f, 30.5f, 41.0f, 51.9f, 62.5f, 75.5f, 87.5f, },
    { 0.0f, 0.0f, 0.8f, 1.9f, 3.7f, 6.0f, 8.7f, 11.9f, 17.5f, 22.8f, 34.5f, 44.6f, 56.2f, 66.0f, 81.0f, 96.0f, },
    { 0.0f, 0.0f, 0.8f, 1.9f, 3.7f, 7.0f, 10.7f, 14.4f, 20.0f, 27.8f, 37.5f, 48.7f, 60.3f, 70.0f, 85.5f, 99.5f, },
    { 0.0f, 0.0f, 0.8f, 1.9f, 5.7f, 8.5f, 12.7f, 17.9f, 24.5f, 33.3f, 45.0f, 54.7f, 65.3f, 74.5f, 88.5f, 100.0f, },
    { 0.0f, 0.0f, 1.3f, 4.4f, 8.2f, 13.0f, 17.7f, 24.4f, 31.5f, 40.8f, 52.0f, 60.7f, 70.3f, 79.0f, 89.0f, 100.0f, },
    { 0.0f, 1.0f, 3.3f, 6.9f, 12.7f, 19.5f, 26.2f, 33.9f, 43.0f, 52.3f, 61.5f, 69.7f, 78.3f, 85.5f, 93.5f, 100.0f, },
    { 0.0f, 2.0f, 8.8f, 14.9f, 21.7f, 29.5f, 37.7f, 48.4f, 56.0f, 65.3f, 71.5f, 79.7f, 84.8f, 90.5f, 96.5f, 100.0f, },
};

static const float default_ignitions[TABLE_FILLING_MAX][TABLE_ROTATES_MAX] = {
    { 15.7f, 16.0f, 16.2f, 19.0f, 24.0f, 29.0f, 37.0f, 40.0f, 42.0f, 43.0f, 43.0f, 44.0f, 44.0f, 44.0f, 44.0f, 45.0f, },
    { 16.0f, 16.6f, 17.6f, 21.7f, 26.0f, 31.0f, 38.0f, 41.0f, 42.0f, 43.0f, 43.0f, 44.0f, 44.0f, 44.0f, 44.0f, 45.0f, },
    { 16.1f, 16.8f, 18.3f, 22.6f, 27.0f, 31.0f, 38.0f, 41.0f, 42.0f, 43.0f, 43.0f, 44.0f, 44.0f, 44.0f, 44.0f, 45.0f, },
    { 16.2f, 16.9f, 19.0f, 22.6f, 25.3f, 29.1f, 38.0f, 40.0f, 42.0f, 43.0f, 43.0f, 44.0f, 44.0f, 44.0f, 44.0f, 44.0f, },
    { 15.3f, 16.6f, 17.1f, 21.2f, 23.6f, 27.1f, 32.8f, 36.2f, 37.4f, 39.0f, 39.0f, 40.4f, 40.7f, 40.8f, 41.0f, 41.8f, },
    { 14.9f, 14.7f, 15.2f, 17.1f, 18.8f, 24.0f, 30.4f, 33.7f, 34.3f, 35.1f, 35.7f, 37.1f, 37.8f, 38.4f, 38.4f, 39.0f, },
    { 14.0f, 14.3f, 13.5f, 14.8f, 16.1f, 20.4f, 26.3f, 28.9f, 32.5f, 32.6f, 33.9f, 35.2f, 36.6f, 37.3f, 37.5f, 38.0f, },
    { 12.6f, 13.5f, 12.3f, 14.0f, 15.8f, 20.5f, 25.9f, 27.9f, 32.5f, 33.5f, 31.6f, 33.2f, 35.5f, 36.7f, 36.8f, 37.6f, },
    { 12.8f, 12.9f, 12.0f, 12.8f, 14.9f, 19.2f, 25.7f, 26.5f, 32.6f, 32.0f, 30.7f, 32.7f, 35.0f, 35.9f, 36.5f, 38.1f, },
    { 13.2f, 12.8f, 12.2f, 13.0f, 13.9f, 18.6f, 22.5f, 25.0f, 32.3f, 32.8f, 30.7f, 31.5f, 34.4f, 35.3f, 35.9f, 38.3f, },
    { 12.5f, 12.2f, 12.6f, 13.1f, 13.5f, 17.7f, 23.3f, 24.9f, 33.2f, 34.7f, 30.5f, 31.3f, 33.5f, 34.4f, 35.4f, 36.4f, },
    { 12.8f, 13.2f, 13.7f, 13.4f, 13.7f, 17.8f, 22.9f, 24.8f, 33.2f, 34.1f, 30.6f, 30.6f, 32.7f, 33.6f, 34.0f, 35.3f, },
    { 12.5f, 12.7f, 14.2f, 14.4f, 13.8f, 18.1f, 23.5f, 24.7f, 33.5f, 33.8f, 30.1f, 29.7f, 32.0f, 32.4f, 33.0f, 34.8f, },
    { 12.0f, 13.5f, 14.0f, 14.6f, 15.2f, 19.8f, 24.3f, 24.6f, 32.5f, 33.4f, 29.5f, 29.2f, 30.9f, 31.3f, 32.0f, 34.2f, },
    { 10.8f, 12.0f, 13.9f, 14.2f, 15.4f, 19.6f, 22.6f, 24.7f, 31.1f, 32.1f, 29.5f, 28.7f, 30.3f, 30.6f, 31.9f, 33.4f, },
    { 11.6f, 11.8f, 13.3f, 14.1f, 15.4f, 19.0f, 21.7f, 24.7f, 29.6f, 30.4f, 29.3f, 28.6f, 29.7f, 29.9f, 31.2f, 32.9f, },
};

static const float default_fuel_mixtures[TABLE_FILLING_MAX][TABLE_ROTATES_MAX] = {
    { 13.6f, 13.7f, 13.8f, 13.9f, 14.0f, 14.0f, 14.0f, 14.0f, 14.0f, 14.0f, 14.0f, 14.0f, 14.0f, 14.0f, 14.0f, 14.0f, },
    { 13.6f, 13.7f, 13.8f, 13.9f, 14.0f, 14.0f, 14.0f, 14.0f, 14.0f, 14.0f, 14.0f, 14.0f, 14.0f, 14.0f, 14.0f, 14.0f, },
    { 13.6f, 13.7f, 13.8f, 13.9f, 14.0f, 14.0f, 14.0f, 14.0f, 14.0f, 14.0f, 14.0f, 14.0f, 14.0f, 14.0f, 14.0f, 14.0f, },
    { 13.6f, 13.7f, 13.8f, 13.9f, 14.0f, 14.0f, 14.0f, 14.0f, 14.0f, 14.0f, 14.0f, 14.0f, 14.0f, 14.0f, 14.0f, 14.0f, },
    { 13.6f, 13.7f, 13.8f, 13.9f, 13.9f, 13.9f, 13.9f, 13.9f, 13.9f, 13.9f, 13.9f, 13.9f, 13.9f, 13.9f, 13.9f, 13.9f, },
    { 13.6f, 13.7f, 13.8f, 13.9f, 13.9f, 13.9f, 13.9f, 13.9f, 13.9f, 13.9f, 13.9f, 13.9f, 13.9f, 13.9f, 13.9f, 13.9f, },
    { 13.6f, 13.7f, 13.8f, 13.8f, 13.8f, 13.8f, 13.8f, 13.8f, 13.8f, 13.8f, 13.8f, 13.8f, 13.8f, 13.8f, 13.8f, 13.8f, },
    { 13.5f, 13.7f, 13.7f, 13.7f, 13.7f, 13.7f, 13.7f, 13.7f, 13.7f, 13.7f, 13.7f, 13.7f, 13.7f, 13.7f, 13.7f, 13.7f, },
    { 13.4f, 13.5f, 13.5f, 13.5f, 13.5f, 13.5f, 13.5f, 13.5f, 13.5f, 13.5f, 13.5f, 13.5f, 13.5f, 13.5f, 13.5f, 13.5f, },
    { 13.3f, 13.4f, 13.4f, 13.4f, 13.4f, 13.4f, 13.4f, 13.4f, 13.4f, 13.4f, 13.4f, 13.4f, 13.4f, 13.4f, 13.4f, 13.4f, },
    { 13.2f, 13.2f, 13.2f, 13.2f, 13.2f, 13.2f, 13.2f, 13.2f, 13.2f, 13.2f, 13.2f, 13.2f, 13.2f, 13.2f, 13.2f, 13.2f, },
    { 13.0f, 13.0f, 13.0f, 13.0f, 13.0f, 13.0f, 13.0f, 13.0f, 13.0f, 13.0f, 13.0f, 13.0f, 13.0f, 13.0f, 13.0f, 13.0f, },
    { 12.8f, 12.8f, 12.8f, 12.8f, 12.8f, 12.8f, 12.8f, 12.8f, 12.8f, 12.8f, 12.8f, 12.8f, 12.8f, 12.8f, 12.8f, 12.8f, },
    { 12.8f, 12.8f, 12.8f, 12.8f, 12.8f, 12.8f, 12.8f, 12.8f, 12.8f, 12.8f, 12.8f, 12.8f, 12.8f, 12.8f, 12.8f, 12.8f, },
    { 12.8f, 12.8f, 12.8f, 12.8f, 12.8f, 12.8f, 12.8f, 12.8f, 12.8f, 12.8f, 12.8f, 12.8f, 12.8f, 12.8f, 12.8f, 12.8f, },
    { 12.8f, 12.8f, 12.8f, 12.8f, 12.8f, 12.8f, 12.8f, 12.8f, 12.8f, 12.8f, 12.8f, 12.8f, 12.8f, 12.8f, 12.8f, 12.8f, },
};

static const float default_injection_phase[TABLE_FILLING_MAX][TABLE_ROTATES_MAX] = {
    { 156, 156, 157, 157, 157, 156, 156, 156, 160, 171, 196, 227, 254, 268, 274, 276, },
    { 157, 157, 158, 158, 158, 160, 161, 164, 170, 183, 206, 237, 262, 277, 284, 287, },
    { 159, 159, 160, 160, 161, 165, 169, 174, 182, 198, 220, 248, 274, 288, 297, 301, },
    { 162, 163, 163, 164, 165, 172, 179, 187, 198, 216, 238, 265, 288, 304, 313, 318, },
    { 171, 172, 173, 175, 177, 186, 195, 205, 219, 239, 260, 286, 308, 323, 332, 337, },
    { 182, 183, 185, 188, 191, 203, 215, 228, 245, 267, 288, 312, 332, 346, 355, 360, },
    { 197, 199, 202, 207, 212, 227, 242, 258, 278, 302, 321, 342, 360, 372, 381, 386, },
    { 218, 221, 226, 233, 241, 259, 278, 298, 319, 344, 361, 378, 392, 403, 411, 416, },
    { 243, 246, 253, 262, 274, 297, 319, 342, 366, 390, 404, 417, 429, 437, 444, 448, },
    { 264, 268, 276, 289, 304, 333, 359, 384, 409, 434, 446, 457, 465, 473, 480, 483, },
    { 278, 282, 293, 307, 329, 361, 391, 419, 447, 473, 487, 501, 509, 516, 527, 538, },
    { 289, 293, 303, 323, 344, 381, 412, 441, 469, 495, 507, 516, 523, 529, 539, 550, },
    { 300, 304, 315, 333, 359, 394, 425, 454, 481, 507, 519, 529, 536, 541, 551, 557, },
    { 313, 317, 326, 344, 368, 403, 432, 460, 487, 512, 525, 534, 541, 546, 553, 561, },
    { 326, 329, 338, 354, 378, 409, 437, 463, 489, 514, 526, 535, 542, 548, 557, 565, },
    { 337, 339, 347, 363, 385, 414, 441, 466, 490, 514, 527, 536, 542, 548, 557, 568, },
};

static const float default_injection_phase_lpf[TABLE_ROTATES_MAX] = {
    0.20f, 0.20f, 0.20f, 0.20f, 0.20f, 0.20f, 0.20f, 0.20f,
    0.20f, 0.20f, 0.20f, 0.20f, 0.20f, 0.20f, 0.20f, 0.20f,
};

static const float default_enrichment_rate_start_load[TABLE_ENRICHMENT_PERCENTS_MAX] = {
    0.0f, 5.0f, 10.0f, 15.0f, 25.0f, 40.0f, 60.0f, 80.0f
};

static const float default_enrichment_rate_load_derivative[TABLE_ENRICHMENT_PERCENTS_MAX] = {
    0, 500, 1200, 2000, 3200, 4500, 6000, 8000,
};

static const float default_enrichment_rate[TABLE_ENRICHMENT_PERCENTS_MAX][TABLE_ENRICHMENT_PERCENTS_MAX] = {
    { 0.00f, 0.31f, 0.55f, 0.70f, 0.80f, 0.85f, 0.95f, 1.00f, },
    { 0.00f, 0.23f, 0.46f, 0.60f, 0.70f, 0.75f, 0.80f, 0.90f, },
    { 0.00f, 0.15f, 0.34f, 0.45f, 0.50f, 0.55f, 0.60f, 0.75f, },
    { 0.00f, 0.09f, 0.21f, 0.34f, 0.40f, 0.46f, 0.53f, 0.65f, },
    { 0.00f, 0.00f, 0.04f, 0.20f, 0.28f, 0.35f, 0.40f, 0.45f, },
    { 0.00f, 0.00f, 0.00f, 0.08f, 0.16f, 0.21f, 0.24f, 0.27f, },
    { 0.00f, 0.00f, 0.00f, 0.01f, 0.04f, 0.06f, 0.08f, 0.09f, },
    { 0.00f, 0.00f, 0.00f, 0.00f, 0.00f, 0.00f, 0.00f, 0.00f, },
};

static const float default_enrichment_tps_selection[TABLE_ENRICHMENT_PERCENTS_MAX][TABLE_ENRICHMENT_PERCENTS_MAX] = {
    { 0.00f, 0.40f, 0.60f, 0.85f, 0.97f, 1.00f, 1.00f, 1.00f, },
    { 0.00f, 0.36f, 0.54f, 0.74f, 0.94f, 0.98f, 0.99f, 1.00f, },
    { 0.00f, 0.28f, 0.50f, 0.66f, 0.85f, 0.95f, 0.98f, 1.00f, },
    { 0.00f, 0.21f, 0.44f, 0.57f, 0.79f, 0.89f, 0.96f, 1.00f, },
    { 0.00f, 0.14f, 0.37f, 0.50f, 0.69f, 0.79f, 0.89f, 1.00f, },
    { 0.00f, 0.09f, 0.28f, 0.40f, 0.59f, 0.71f, 0.80f, 0.88f, },
    { 0.00f, 0.04f, 0.17f, 0.31f, 0.48f, 0.60f, 0.70f, 0.75f, },
    { 0.00f, 0.00f, 0.10f, 0.24f, 0.36f, 0.50f, 0.58f, 0.62f, },
};

static const float default_enrichment_accel_dead_band[TABLE_ROTATES_MAX] = {
    37000, 39000, 42000, 45000, 50000, 58000, 68000, 78000,
    88000, 100000, 109000, 124000, 141000, 164000, 197000, 220000,
};

static const float default_enrichment_sync_amount[TABLE_ROTATES_MAX] = {
    0.50f, 0.50f, 0.50f, 0.55f, 0.60f, 0.65f, 0.73f, 0.80f,
    0.83f, 0.85f, 0.87f, 0.89f, 0.91f, 0.93f, 0.97f, 1.00f,
};

static const float default_enrichment_async_amount[TABLE_ROTATES_MAX] = {
    0.30f, 0.30f, 0.30f, 0.32f, 0.35f, 0.39f, 0.43f, 0.48f,
    0.51f, 0.53f, 0.55f, 0.58f, 0.65f, 0.76f, 0.80f, 0.80f,
};

static const float default_enrichment_ign_corr[TABLE_ROTATES_MAX][TABLE_ENRICHMENT_PERCENTS_MAX] = {
    { -4.0f, -3.9f, -3.7f, -3.6f, -3.3f, -2.9f, -2.4f, -2.0f, },
    { -4.0f, -3.9f, -3.7f, -3.6f, -3.3f, -2.9f, -2.4f, -2.0f, },
    { -4.0f, -3.9f, -3.7f, -3.6f, -3.3f, -2.9f, -2.4f, -2.0f, },
    { -4.0f, -3.9f, -3.7f, -3.5f, -3.3f, -2.9f, -2.4f, -2.0f, },
    { -3.8f, -3.7f, -3.5f, -3.4f, -3.2f, -2.8f, -2.3f, -1.9f, },
    { -3.5f, -3.5f, -3.2f, -3.1f, -3.0f, -2.6f, -2.2f, -1.8f, },
    { -3.2f, -3.2f, -2.9f, -2.9f, -2.8f, -2.5f, -2.0f, -1.7f, },
    { -2.9f, -2.9f, -2.6f, -2.6f, -2.5f, -2.3f, -1.9f, -1.6f, },
    { -2.4f, -2.4f, -2.3f, -2.2f, -2.2f, -2.0f, -1.8f, -1.5f, },
    { -3.0f, -3.0f, -2.9f, -2.7f, -2.5f, -2.3f, -2.1f, -1.9f, },
    { -2.4f, -2.4f, -2.3f, -2.2f, -2.2f, -2.0f, -2.0f, -1.8f, },
    { -2.0f, -2.0f, -1.9f, -1.9f, -1.6f, -1.4f, -1.4f, -1.3f, },
    { -1.0f, -1.0f, -0.8f, -0.6f, -0.7f, -0.7f, -0.9f, -1.2f, },
    { -0.2f, -0.2f, -0.3f, -0.4f, -0.5f, -0.6f, -0.9f, -1.2f, },
    { 0.0f, -0.1f, -0.1f, -0.2f, -0.3f, -0.5f, -0.8f, -1.1f, },
    { 0.0f, -0.1f, -0.1f, -0.2f, -0.3f, -0.5f, -0.8f, -1.0f, },
};


static const float default_enrichment_temp_mult[TABLE_TEMPERATURES_MAX] = {
    2.80f, 2.60f, 2.40f, 2.10f, 1.70f, 1.30f, 0.90f, 0.60f,
    0.33f, 0.15f, 0.00f, 0.00f, 0.00f, 0.00f, 0.00f, 0.00f,
};

static const float default_enrichment_injection_phase[TABLE_ROTATES_MAX] = {
    0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0,
};

static const float default_ignition_time_rpm_mult[TABLE_ROTATES_MAX] = {
    4.0f, 1.7f, 1.1f, 1.0f, 1.0f, 1.0f, 1.0f, 1.0f,
    1.0f, 1.0f, 1.0f, 1.0f, 1.0f, 1.0f, 1.0f, 1.0f
};

static const float default_voltages[8] = {
    0.0f, 6.0f, 8.0f, 10.0f, 12.0f, 14.0f, 16.0f, 25.0f
};

static const float default_ignition_time[TABLE_VOLTAGES_MAX] = {
    5700, 4500, 3200, 2500, 2100, 1800, 1600, 1000
};

static const float default_injector_lag[TABLE_VOLTAGES_MAX] = {
    5.00f, 3.00f, 2.18f, 1.67f, 1.18f, 0.91f, 0.63f, 0.03f,
};

static const float default_engine_temps[TABLE_TEMPERATURES_MAX] = {
    -20, -10, 0, 10, 20, 30, 40, 50,
    60, 70, 80, 90, 100, 110, 120, 130
};

static const float default_warmup_mixtures[TABLE_TEMPERATURES_MAX] = {
    13.4f, 13.5f, 13.6f, 13.7f, 13.8f, 13.9f, 14.4f, 14.7f,
    14.7f, 14.6f, 14.6f, 14.6f, 14.6f, 14.0f, 13.6f, 13.0f
};

static const float default_warmup_mix_koffs[TABLE_TEMPERATURES_MAX] = {
    0.00f, 0.00f, 0.00f, 0.00f, 0.00f, 0.00f, 0.00f, 0.00f,
    0.00f, 0.00f, 0.00f, 0.00f, 0.00f, 0.00f, 0.00f, 0.00f,
};

static const float default_warmup_mix_corrs[TABLE_TEMPERATURES_MAX] = {
    0.06f, 0.06f, 0.05f, 0.05f, 0.04f, 0.03f, 0.02f, 0.01f,
    0.01f, 0.00f, 0.00f, 0.00f, 0.00f, 0.00f, 0.00f, 0.00f,
};

static const float default_cold_start_idle_corrs[TABLE_TEMPERATURES_MAX] = {
    0.30f, 0.30f, 0.30f, 0.28f, 0.24f, 0.18f, 0.17f, 0.13f,
    0.09f, 0.05f, 0.04f, 0.03f, 0.01f, 0.01f, 0.01f, 0.01f,
};

static const float default_cold_start_idle_times[TABLE_TEMPERATURES_MAX] = {
    25, 24, 23, 22, 18, 13, 7, 5,
    4, 3, 2, 1, 1, 1, 1, 1,
};

static const float default_start_tps_corrs[TABLE_THROTTLES_MAX] = {
    1.00f, 1.00f, 1.00f, 1.00f, 0.98f, 0.94f, 0.90f, 0.86f,
    0.81f, 0.77f, 0.72f, 0.65f, 0.56f, 0.38f, 0.00f, 0.00f,
};

static const float default_start_async_filling[TABLE_TEMPERATURES_MAX] = {
    0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0,
};

static const float default_start_large_filling[TABLE_TEMPERATURES_MAX] = {
    2000, 1900, 1800, 1600, 1300, 1000, 800, 650,
    550, 500, 450, 430, 430, 430, 430, 430,
};

static const float default_start_small_filling[TABLE_TEMPERATURES_MAX] = {
    850, 830, 730, 630, 500, 420, 370, 340,
    320, 310, 310, 310, 310, 310, 310, 310,
};

static const float default_start_filling_time[TABLE_TEMPERATURES_MAX] = {
    1.3f, 1.3f, 1.2f, 1.1f, 0.9f, 0.8f, 0.6f, 0.5f,
    0.4f, 0.3f, 0.3f, 0.2f, 0.1f, 0.1f, 0.1f, 0.1f,
};

static const float default_start_injection_phase[TABLE_TEMPERATURES_MAX] = {
    50, 50, 60, 70, 80, 90, 100, 100,
    100, 100, 100, 100, 100, 100, 100, 100,
};

static const float default_start_ignition[TABLE_TEMPERATURES_MAX] = {
    10.0f, 10.0f, 10.0f, 10.0f, 10.0f, 10.0f, 10.0f, 10.0f,
    10.0f, 10.0f, 10.0f, 10.0f, 10.0f, 10.0f, 10.0f, 10.0f
};

static const float default_start_idle_valve_pos[TABLE_TEMPERATURES_MAX] = {
    100.0f, 100.0f, 95.0f, 90.0f, 85.0f, 80.0f, 75.0f, 70.0f,
    65.0f, 60.0f, 55.0f, 55.0f, 55.0f, 50.0f, 50.0f, 50.0f,
};

static const float default_idle_wish_rotates[TABLE_TEMPERATURES_MAX] = {
    1560, 1560, 1520, 1500, 1460, 1420, 1380, 1350,
    1300, 1280, 1250, 1250, 1250, 1290, 1340, 1400,
};

static const float default_idle_valve_position[TABLE_TEMPERATURES_MAX] = {
    70, 70, 70, 70, 65, 60, 55, 55,
    53, 50, 50, 50, 50, 50, 50, 50,
};

static const float default_idle_valve_econ_position[TABLE_ROTATES_MAX] = {
    60, 59, 57, 55, 52, 49, 47, 45,
    42, 37, 35, 35, 38, 45, 49, 50,
};

static const float default_idle_wish_massair[TABLE_TEMPERATURES_MAX] = {
    27.0f, 26.0f, 25.0f, 24.0f, 23.3f, 21.6f, 19.9f, 18.0f,
    17.4f, 16.7f, 16.0f, 16.0f, 16.0f, 17.0f, 18.0f, 18.5f,
};

static const float default_idle_wish_ignition_static[TABLE_ROTATES_MAX] = {
    14.0f, 16.0f, 18.0f, 21.0f, 25.0f, 25.7f, 23.0f, 20.0f,
    17.0f, 14.0f, 11.0f, 10.0f, 10.0f, 11.0f, 13.0f, 17.0f,
};

static const float default_idle_wish_ignition[TABLE_TEMPERATURES_MAX] = {
    20.0f, 20.0f, 20.0f, 20.0f, 18.9f, 15.0f, 12.7f, 11.0f,
    10.0f, 9.0f, 8.0f, 8.0f, 9.0f, 10.8f, 12.3f, 14.0f,
};

static const float default_speeds[TABLE_SPEEDS_MAX] = {
    0, 3, 10, 20, 30, 40, 50, 60,
    70, 80, 90, 100, 110, 120, 130, 140
};

static const float default_idle_rpm_shift[TABLE_SPEEDS_MAX] = {
    0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0,
};

static const float default_knock_noise_level[TABLE_ROTATES_MAX] = {
    1.00f, 1.00f, 1.00f, 1.00f, 1.00f, 1.00f, 1.00f, 1.00f,
    1.00f, 1.02f, 1.05f, 1.10f, 1.20f, 1.30f, 1.45f, 1.60f,
};

static const float default_knock_threshold[TABLE_ROTATES_MAX] = {
    1.00f, 1.00f, 1.00f, 1.00f, 1.00f, 1.00f, 1.00f, 1.00f,
    1.00f, 1.00f, 1.00f, 1.00f, 1.00f, 1.00f, 1.00f, 1.00f,
};

static const float default_knock_detect_phase_start[TABLE_ROTATES_MAX] = {
    -19, -23, -27, -31, -35, -39, -42, -45,
    -47, -48, -49, -50, -50, -50, -50, -50,
};

static const float default_knock_detect_phase_end[TABLE_ROTATES_MAX] = {
    2, 3, 4, 6, 8, 9, 10, 10,
    10, 10, 10, 10, 10, 10, 10, 10,
};

static const float default_knock_integrator_time[TABLE_ROTATES_MAX] = {
    11, 11, 11, 11, 11, 11, 11, 11,
    11, 11, 11, 11, 11, 11, 11, 11,
};

static const float default_knock_filter_frequency[TABLE_ROTATES_MAX] = {
    41, 41, 41, 41, 41, 41, 41, 41,
    42, 42, 42, 42, 42, 43, 43, 43,
};

static const float default_knock_gain[TABLE_ROTATES_MAX] = {
    1, 1, 1, 2, 4, 6, 13, 18,
    28, 33, 38, 47, 54, 58, 60, 60,
};

static const float default_knock_zone[TABLE_FILLING_MAX][TABLE_ROTATES_MAX] = {
    { 0.00f, 0.00f, 0.00f, 0.00f, 0.00f, 0.00f, 0.00f, 0.00f, 0.00f, 0.00f, 0.00f, 0.00f, 0.00f, 0.00f, 0.00f, 0.00f, },
    { 0.00f, 0.00f, 0.00f, 0.00f, 0.00f, 0.00f, 0.00f, 0.00f, 0.00f, 0.00f, 0.00f, 0.00f, 0.00f, 0.00f, 0.00f, 0.00f, },
    { 0.00f, 0.00f, 0.00f, 0.00f, 0.00f, 0.00f, 0.00f, 0.00f, 0.00f, 0.00f, 0.00f, 0.00f, 0.00f, 0.00f, 0.00f, 0.00f, },
    { 0.00f, 0.00f, 0.00f, 0.00f, 0.00f, 0.00f, 0.00f, 0.00f, 0.00f, 0.00f, 0.00f, 0.00f, 0.00f, 0.00f, 0.00f, 0.00f, },
    { 0.50f, 0.00f, 0.00f, 0.00f, 0.00f, 0.00f, 0.00f, 0.00f, 0.00f, 0.00f, 0.00f, 0.00f, 0.00f, 0.00f, 0.00f, 0.00f, },
    { 1.00f, 0.50f, 0.00f, 0.00f, 0.00f, 0.00f, 0.00f, 0.00f, 0.00f, 0.00f, 0.00f, 0.00f, 0.00f, 0.00f, 0.00f, 0.00f, },
    { 1.00f, 1.00f, 0.50f, 0.50f, 0.50f, 0.50f, 0.50f, 0.50f, 0.50f, 0.50f, 0.50f, 0.50f, 0.50f, 0.50f, 0.50f, 0.50f, },
    { 1.00f, 1.00f, 1.00f, 1.00f, 1.00f, 1.00f, 1.00f, 1.00f, 1.00f, 1.00f, 1.00f, 1.00f, 1.00f, 1.00f, 1.00f, 1.00f, },
    { 1.00f, 1.00f, 1.00f, 1.00f, 1.00f, 1.00f, 1.00f, 1.00f, 1.00f, 1.00f, 1.00f, 1.00f, 1.00f, 1.00f, 1.00f, 1.00f, },
    { 1.00f, 1.00f, 1.00f, 1.00f, 1.00f, 1.00f, 1.00f, 1.00f, 1.00f, 1.00f, 1.00f, 1.00f, 1.00f, 1.00f, 1.00f, 1.00f, },
    { 1.00f, 1.00f, 1.00f, 1.00f, 1.00f, 1.00f, 1.00f, 1.00f, 1.00f, 1.00f, 1.00f, 1.00f, 1.00f, 1.00f, 1.00f, 1.00f, },
    { 1.00f, 1.00f, 1.00f, 1.00f, 1.00f, 1.00f, 1.00f, 1.00f, 1.00f, 1.00f, 1.00f, 1.00f, 1.00f, 1.00f, 1.00f, 1.00f, },
    { 1.00f, 1.00f, 1.00f, 1.00f, 1.00f, 1.00f, 1.00f, 1.00f, 1.00f, 1.00f, 1.00f, 1.00f, 1.00f, 1.00f, 1.00f, 1.00f, },
    { 1.00f, 1.00f, 1.00f, 1.00f, 1.00f, 1.00f, 1.00f, 1.00f, 1.00f, 1.00f, 1.00f, 1.00f, 1.00f, 1.00f, 1.00f, 1.00f, },
    { 1.00f, 1.00f, 1.00f, 1.00f, 1.00f, 1.00f, 1.00f, 1.00f, 1.00f, 1.00f, 1.00f, 1.00f, 1.00f, 1.00f, 1.00f, 1.00f, },
    { 1.00f, 1.00f, 1.00f, 1.00f, 1.00f, 1.00f, 1.00f, 1.00f, 1.00f, 1.00f, 1.00f, 1.00f, 1.00f, 1.00f, 1.00f, 1.00f, },
};

static const float default_knock_cy_level_multiplier[ECU_CYLINDERS_COUNT][TABLE_ROTATES_MAX] = {
    { 1.08f, 1.38f, 1.27f, 1.56f, 1.56f, 1.37f, 1.28f, 1.42f, 1.37f, 1.35f, 1.19f, 1.08f, 1.05f, 1.07f, 1.02f, 1.00f, },
    { 1.04f, 1.19f, 1.12f, 1.09f, 1.03f, 1.07f, 1.05f, 1.14f, 1.12f, 1.16f, 1.02f, 0.94f, 1.00f, 0.99f, 1.00f, 1.00f, },
    { 1.06f, 1.22f, 1.13f, 1.24f, 1.16f, 1.03f, 1.06f, 1.03f, 0.97f, 1.06f, 1.04f, 0.98f, 1.01f, 1.00f, 1.01f, 1.00f, },
    { 1.05f, 1.22f, 1.15f, 1.27f, 1.30f, 1.26f, 1.25f, 1.40f, 1.44f, 1.41f, 1.30f, 1.13f, 1.06f, 1.07f, 1.02f, 1.00f, },
};

static const float default_air_temps[TABLE_TEMPERATURES_MAX] = {
    -40, -30, -20, -10, -5, 0, 5, 10,
    15, 20, 30, 40, 50, 60, 70, 80
};

static const float default_air_temp_mix_corrs[TABLE_TEMPERATURES_MAX][TABLE_FILLING_MAX] = {
    { 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f },
    { 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f },
    { 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f },
    { 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f },
    { 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f },
    { 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f },
    { 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f },
    { 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f },
    { 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f },
    { 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f },
    { 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f },
    { 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f },
    { 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f },
    { 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f },
    { 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f },
    { 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f },
};

static const float default_air_temp_ign_corrs[TABLE_TEMPERATURES_MAX][TABLE_FILLING_MAX] = {
    { 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 1.0f, 1.5f, 2.0f, 2.0f, 2.0f, 2.0f, 2.0f, 2.0f, 2.0f, 2.0f, 2.0f, },
    { 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 1.0f, 1.5f, 2.0f, 2.0f, 2.0f, 2.0f, 2.0f, 2.0f, 2.0f, 2.0f, },
    { 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 1.0f, 1.5f, 2.0f, 2.0f, 2.0f, 2.0f, 2.0f, 2.0f, 2.0f, },
    { 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 1.0f, 1.5f, 2.0f, 2.0f, 2.0f, 2.0f, 2.0f, 2.0f, },
    { 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 1.0f, 1.0f, 1.5f, 1.5f, 1.5f, 1.5f, 1.5f, },
    { 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 1.0f, 1.0f, 1.5f, 1.5f, 1.5f, 1.5f, },
    { 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 1.0f, 1.0f, 1.0f, 1.0f, 1.0f, },
    { 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 1.0f, 1.0f, 1.0f, 1.0f, },
    { 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, },
    { 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, },
    { 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, },
    { 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, },
    { 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, -1.0f, -1.0f, -1.0f, -1.0f, -1.0f, -1.0f, },
    { 0.0f, 0.0f, 0.0f, 0.0f, -0.5f, -0.5f, -0.5f, -1.0f, -1.0f, -1.0f, -1.5f, -1.5f, -1.5f, -1.5f, -1.5f, -1.5f, },
    { 0.0f, 0.0f, 0.0f, -0.5f, -0.5f, -1.0f, -1.0f, -2.0f, -2.0f, -2.0f, -2.3f, -2.3f, -2.3f, -2.3f, -2.3f, -2.3f, },
    { 0.0f, 0.0f, -0.5f, -0.5f, -1.0f, -2.0f, -2.5f, -2.5f, -2.5f, -3.0f, -3.0f, -3.0f, -3.0f, -3.0f, -3.0f, -3.0f, },
};

static const float default_engine_temp_mix_corrs[TABLE_TEMPERATURES_MAX][TABLE_FILLING_MAX] = {
    { 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f },
    { 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f },
    { 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f },
    { 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f },
    { 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f },
    { 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f },
    { 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f },
    { 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f },
    { 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f },
    { 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f },
    { 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f },
    { 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f },
    { 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f },
    { 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f },
    { 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f },
    { 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f },
};

static const float default_engine_temp_ign_corrs[TABLE_TEMPERATURES_MAX][TABLE_FILLING_MAX] = {
    { 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, },
    { 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, },
    { 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, },
    { 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, },
    { 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, },
    { 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, },
    { 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, },
    { 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, },
    { 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, },
    { 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, },
    { 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, },
    { 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, -1.0f, -1.0f, -1.0f, -1.0f, -1.0f, -1.0f, -1.0f, -1.0f, -1.0f, -1.0f, },
    { 0.0f, 0.0f, 0.1f, 0.0f, -1.0f, -1.0f, -1.0f, -1.0f, -1.0f, -1.0f, -1.0f, -1.0f, -2.0f, -2.0f, -2.0f, -2.0f, },
    { 0.0f, 0.0f, -1.0f, -1.0f, -2.0f, -3.0f, -4.0f, -4.0f, -4.0f, -4.0f, -4.0f, -4.0f, -4.0f, -4.0f, -4.0f, -4.0f, },
    { 0.0f, -1.0f, -2.0f, -3.0f, -4.0f, -5.0f, -5.0f, -5.0f, -5.0f, -5.0f, -5.0f, -5.0f, -5.0f, -5.0f, -5.0f, -5.0f, },
    { -2.0f, -3.0f, -4.0f, -5.0f, -6.0f, -6.0f, -6.0f, -6.0f, -6.0f, -6.0f, -6.0f, -6.0f, -6.0f, -6.0f, -6.0f, -6.0f, },
};

static const float default_idle_pids_rpm_koffs[TABLE_ROTATES_MAX] = {
    0.45f, 0.53f, 0.61f, 0.69f, 0.77f, 0.85f, 0.93f, 1.00f,
    1.08f, 1.16f, 1.24f, 1.32f, 1.40f, 1.48f, 1.56f, 1.64f
};

static const float default_idle_valve_to_massair_pid_p[TABLE_ROTATES_MAX] = {
    2.000f, 2.000f, 1.900f, 1.800f, 1.700f, 1.600f, 1.400f, 1.200f,
    1.200f, 1.200f, 1.200f, 1.200f, 1.200f, 1.200f, 1.200f, 1.200f,
};

static const float default_idle_valve_to_massair_pid_i[TABLE_ROTATES_MAX] = {
    5.000f, 5.000f, 5.000f, 5.000f, 5.000f, 5.000f, 4.600f, 3.998f,
    3.600f, 2.000f, 1.200f, 0.800f, 0.700f, 0.700f, 0.700f, 0.700f,
};

static const float default_idle_valve_to_massair_pid_d[TABLE_ROTATES_MAX] = {
    0.0020f, 0.0020f, 0.0080f, 0.0130f, 0.0200f, 0.0150f, 0.0020f, 0.0010f,
    0.0010f, 0.0010f, 0.0010f, 0.0010f, 0.0010f, 0.0010f, 0.0010f, 0.0010f,
};

static const float default_idle_valve_to_rpm_pid_p[TABLE_ROTATES_MAX] = {
    0.000f, 0.000f, 0.000f, 0.000f, 0.000f, 0.000f, 0.000f, 0.000f,
    0.000f, 0.000f, 0.000f, 0.000f, 0.000f, 0.000f, 0.000f, 0.000f,
};

static const float default_idle_valve_to_rpm_pid_i[TABLE_ROTATES_MAX] = {
    0.000f, 0.000f, 0.000f, 0.000f, 0.000f, 0.000f, 0.000f, 0.000f,
    0.000f, 0.000f, 0.000f, 0.000f, 0.000f, 0.000f, 0.000f, 0.000f,
};

static const float default_idle_valve_to_rpm_pid_d[TABLE_ROTATES_MAX] = {
    0.0000f, 0.0000f, 0.0000f, 0.0000f, 0.0000f, 0.0000f, 0.0000f, 0.0000f,
    0.0000f, 0.0000f, 0.0000f, 0.0000f, 0.0000f, 0.0000f, 0.0000f, 0.0000f,
};

static const float default_idle_ign_to_rpm_pid_p[TABLE_ROTATES_MAX] = {
    0.020f, 0.020f, 0.020f, 0.020f, 0.020f, 0.010f, 0.004f, 0.000f,
    0.004f, 0.020f, 0.040f, 0.020f, 0.020f, 0.020f, 0.020f, 0.020f,
};

static const float default_idle_ign_to_rpm_pid_i[TABLE_ROTATES_MAX] = {
    0.020f, 0.020f, 0.020f, 0.020f, 0.010f, 0.006f, 0.003f, 0.002f,
    0.003f, 0.005f, 0.008f, 0.004f, 0.002f, 0.002f, 0.002f, 0.002f,
};

static const float default_idle_ign_to_rpm_pid_d[TABLE_ROTATES_MAX] = {
    0.0000f, 0.0000f, 0.0000f, 0.0004f, 0.0004f, 0.0004f, 0.0002f, 0.0001f,
    0.0000f, 0.0000f, 0.0000f, 0.0000f, 0.0000f, 0.0000f, 0.0000f, 0.0000f,
};

static const float default_idle_rpm_pid_act_1[TABLE_TEMPERATURES_MAX] = {
    0.400f, 0.400f, 0.400f, 0.400f, 0.400f, 0.400f, 0.400f, 0.400f,
    0.390f, 0.370f, 0.340f, 0.340f, 0.340f, 0.340f, 0.340f, 0.340f,
};

static const float default_idle_rpm_pid_act_2[TABLE_TEMPERATURES_MAX] = {
    0.600f, 0.600f, 0.600f, 0.600f, 0.600f, 0.600f, 0.600f, 0.550f,
    0.480f, 0.420f, 0.400f, 0.400f, 0.400f, 0.400f, 0.400f, 0.400f,
};

static const float default_tsps_relative_pos[TABLE_ROTATES_MAX] = {
    -112.0f, -112.0f, -112.0f, -112.0f, -112.0f, -111.9f, -111.7f, -111.5f,
    -111.2f, -111.0f, -111.0f, -111.0f, -111.0f, -111.0f, -111.0f, -111.0f,
};

static const float default_tsps_desync_thr[TABLE_ROTATES_MAX] = {
    9.0f, 9.0f, 9.0f, 9.0f, 9.0f, 9.0f, 9.0f, 9.0f,
    9.0f, 9.0f, 9.0f, 9.0f, 9.0f, 9.0f, 9.0f, 9.0f,
};

static const float default_idle_ignition_time_by_tps[TABLE_THROTTLES_MAX] = {
    0.00f, 0.00f, 0.00f, 0.00f, 0.00f, 0.00f, 0.00f, 0.00f,
    0.00f, 0.00f, 0.00f, 0.00f, 0.00f, 0.00f, 0.00f, 0.00f,
};

static const float default_idle_econ_delay[TABLE_TEMPERATURES_MAX] = {
    30.0f, 30.0f, 30.0f, 30.0f, 30.0f, 30.0f, 30.0f, 20.0f,
    10.0f, 3.0f, 1.0f, 0.5f, 0.5f, 0.5f, 0.5f, 0.5f,
};

static const float default_start_econ_delay[TABLE_TEMPERATURES_MAX] = {
    5.0f, 5.0f, 5.0f, 5.0f, 5.0f, 5.0f, 4.8f, 4.5f,
    4.0f, 3.5f, 3.2f, 3.0f, 3.0f, 3.0f, 3.0f, 3.0f,
};

static const float default_fan_advance_control[TABLE_TEMPERATURES_MAX][TABLE_SPEEDS_MAX] = {
    { -1.00f, -1.00f, -1.00f, -1.00f, -1.00f, -1.00f, -1.00f, -1.00f, -1.00f, -1.00f, -1.00f, -1.00f, -1.00f, -1.00f, -1.00f, -1.00f, },
    { -1.00f, -1.00f, -1.00f, -1.00f, -1.00f, -1.00f, -1.00f, -1.00f, -1.00f, -1.00f, -1.00f, -1.00f, -1.00f, -1.00f, -1.00f, -1.00f, },
    { -1.00f, -1.00f, -1.00f, -1.00f, -1.00f, -1.00f, -1.00f, -1.00f, -1.00f, -1.00f, -1.00f, -1.00f, -1.00f, -1.00f, -1.00f, -1.00f, },
    { -1.00f, -1.00f, -1.00f, -1.00f, -1.00f, -1.00f, -1.00f, -1.00f, -1.00f, -1.00f, -1.00f, -1.00f, -1.00f, -1.00f, -1.00f, -1.00f, },
    { -1.00f, -1.00f, -1.00f, -1.00f, -1.00f, -1.00f, -1.00f, -1.00f, -1.00f, -1.00f, -1.00f, -1.00f, -1.00f, -1.00f, -1.00f, -1.00f, },
    { -1.00f, -1.00f, -1.00f, -1.00f, -1.00f, -1.00f, -1.00f, -1.00f, -1.00f, -1.00f, -1.00f, -1.00f, -1.00f, -1.00f, -1.00f, -1.00f, },
    { -1.00f, -1.00f, -1.00f, -1.00f, -1.00f, -1.00f, -1.00f, -1.00f, -1.00f, -1.00f, -1.00f, -1.00f, -1.00f, -1.00f, -1.00f, -1.00f, },
    { -1.00f, -1.00f, -1.00f, -1.00f, -1.00f, -1.00f, -1.00f, -1.00f, -1.00f, -1.00f, -1.00f, -1.00f, -1.00f, -1.00f, -1.00f, -1.00f, },
    { -1.00f, -1.00f, -1.00f, -1.00f, -1.00f, -1.00f, -1.00f, -1.00f, -1.00f, -1.00f, -1.00f, -1.00f, -1.00f, -1.00f, -1.00f, -1.00f, },
    { -1.00f, -1.00f, -0.70f, -0.60f, -0.50f, -0.50f, -1.00f, -1.00f, -1.00f, -1.00f, -1.00f, -1.00f, -1.00f, -1.00f, -1.00f, -1.00f, },
    { 0.00f, 0.00f, -0.15f, -0.20f, -0.30f, -0.30f, -0.40f, -0.70f, -0.90f, -1.00f, -1.00f, -1.00f, -1.00f, -1.00f, -1.00f, -1.00f, },
    { 1.00f, 1.00f, 1.00f, 1.00f, 0.70f, 0.70f, 0.50f, 0.25f, 0.25f, 0.25f, 0.15f, -0.10f, -0.10f, -0.10f, -0.10f, -0.10f, },
    { 1.00f, 1.00f, 1.00f, 1.00f, 1.00f, 1.00f, 0.90f, 0.80f, 0.70f, 0.50f, 0.30f, 0.20f, 0.20f, 0.20f, 0.20f, 0.20f, },
    { 1.00f, 1.00f, 1.00f, 1.00f, 1.00f, 1.00f, 1.00f, 1.00f, 1.00f, 1.00f, 1.00f, 1.00f, 1.00f, 1.00f, 1.00f, 1.00f, },
    { 1.00f, 1.00f, 1.00f, 1.00f, 1.00f, 1.00f, 1.00f, 1.00f, 1.00f, 1.00f, 1.00f, 1.00f, 1.00f, 1.00f, 1.00f, 1.00f, },
    { 1.00f, 1.00f, 1.00f, 1.00f, 1.00f, 1.00f, 1.00f, 1.00f, 1.00f, 1.00f, 1.00f, 1.00f, 1.00f, 1.00f, 1.00f, 1.00f, },
};

static const float default_idle_throttle_to_massair_pid_p[TABLE_ROTATES_MAX] = {
    0.200f, 0.200f, 0.200f, 0.190f, 0.180f, 0.170f, 0.150f, 0.120f,
    0.120f, 0.120f, 0.120f, 0.120f, 0.120f, 0.120f, 0.120f, 0.120f,
};

static const float default_idle_throttle_to_massair_pid_i[TABLE_ROTATES_MAX] = {
    0.300f, 0.300f, 0.300f, 0.300f, 0.300f, 0.270f, 0.220f, 0.200f,
    0.170f, 0.080f, 0.060f, 0.050f, 0.050f, 0.050f, 0.050f, 0.050f,
};

static const float default_idle_throttle_to_massair_pid_d[TABLE_ROTATES_MAX] = {
    0.0000f, 0.0000f, 0.0000f, 0.0000f, 0.0000f, 0.0000f, 0.0000f, 0.0000f,
    0.0000f, 0.0000f, 0.0000f, 0.0000f, 0.0000f, 0.0000f, 0.0000f, 0.0000f,
};

static const float default_idle_throttle_to_rpm_pid_p[TABLE_ROTATES_MAX] = {
    0.000f, 0.000f, 0.000f, 0.000f, 0.000f, 0.000f, 0.000f, 0.000f,
    0.000f, 0.000f, 0.000f, 0.000f, 0.000f, 0.000f, 0.000f, 0.000f,
};

static const float default_idle_throttle_to_rpm_pid_i[TABLE_ROTATES_MAX] = {
    0.000f, 0.000f, 0.000f, 0.000f, 0.000f, 0.000f, 0.000f, 0.000f,
    0.000f, 0.000f, 0.000f, 0.000f, 0.000f, 0.000f, 0.000f, 0.000f,
};

static const float default_idle_throttle_to_rpm_pid_d[TABLE_ROTATES_MAX] = {
    0.0000f, 0.0000f, 0.0000f, 0.0000f, 0.0000f, 0.0000f, 0.0000f, 0.0000f,
    0.0000f, 0.0000f, 0.0000f, 0.0000f, 0.0000f, 0.0000f, 0.0000f, 0.0000f,
};

static const float default_throttle_position_1d[TABLE_PEDALS_MAX] = {
    0.0f, 0.0f, 0.0f, 0.0f, 0.6f, 1.2f, 2.3f, 4.0f,
    6.2f, 9.6f, 17.1f, 32.6f, 51.0f, 73.9f, 100.0f, 100.0f,
};

static const float default_throttle_startup_move_time[TABLE_TEMPERATURES_MAX] = {
    3.0f, 3.0f, 3.0f, 3.0f, 3.0f, 3.0f, 3.0f, 3.0f,
    3.0f, 3.0f, 3.0f, 3.0f, 3.0f, 3.0f, 3.0f, 3.0f,
};

static const float default_stop_throttle_position[TABLE_PEDALS_MAX] = {
    0.0f, 1.7f, 3.5f, 5.7f, 8.3f, 11.3f, 15.2f, 19.6f,
    24.8f, 30.9f, 37.8f, 47.0f, 57.0f, 69.1f, 83.5f, 100.0f,
};

static const float default_idle_throttle_position[TABLE_TEMPERATURES_MAX] = {
    6.2f, 5.8f, 5.4f, 5.0f, 4.8f, 4.5f, 4.3f, 3.9f,
    3.6f, 3.3f, 3.2f, 3.2f, 3.2f, 3.3f, 3.4f, 3.6f,
};

static const float default_idle_throttle_econ_position[TABLE_ROTATES_MAX] = {
    3.0f, 3.0f, 3.0f, 3.0f, 3.0f, 2.8f, 2.2f, 1.5f,
    0.5f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f,
};

static const float default_pedal_ignition_control[TABLE_ROTATES_MAX] = {
    8.0f, 8.0f, 8.0f, 8.0f, 8.0f, 8.0f, 8.0f, 8.0f,
    7.9f, 7.5f, 7.1f, 6.4f, 5.5f, 4.3f, 2.9f, 1.5f,
};

static const float default_start_throttle_position[TABLE_TEMPERATURES_MAX] = {
    8.0f, 8.0f, 8.0f, 7.5f, 7.2f, 6.9f, 6.5f, 5.9f,
    5.5f, 5.2f, 5.0f, 5.0f, 5.0f, 5.0f, 5.0f, 5.0f,
};

static const float default_dynamic_fuel_corr_gbc[TABLE_FILLING_MAX] = {
    0.02f, 0.02f, 0.02f, 0.03f, 0.08f, 0.15f, 0.22f, 0.31f,
    0.39f, 0.46f, 0.55f, 0.67f, 0.79f, 0.83f, 0.95f, 1.10f,
};

static const float default_dynamic_fuel_corr_temp[TABLE_TEMPERATURES_MAX] = {
    1.00f, 0.92f, 0.78f, 0.68f, 0.55f, 0.43f, 0.35f, 0.30f,
    0.24f, 0.19f, 0.13f, 0.10f, 0.10f, 0.10f, 0.10f, 0.10f,
};

static const float default_dynamic_fuel_corr_lpf[TABLE_ROTATES_MAX] = {
    0.75f, 0.75f, 0.75f, 0.75f, 0.75f, 0.75f, 0.75f, 0.75f,
    0.75f, 0.75f, 0.75f, 0.75f, 0.75f, 0.75f, 0.75f, 0.75f,
};


void config_default_table(sEcuTable *table, uint8_t number)
{
  memset(table, 0, sizeof(sEcuTable));

  sprintf(table->name, "Default %d", number + 1);

  table->inj_channel = InjectorChannel1;

  //Bosch 0280155968 - 420 cc/min
  //Bosch 0280156095 - 315 cc/min
  //Bosch 0280155746 - 200 cc/min
  //BMW 03762FA - 180 cc/min
  table->injector_performance = 523.0f;

  table->is_fuel_phase_by_end = 1;
  table->enrichment_ph_sync_enabled = 1;
  table->enrichment_ph_async_enabled = 0;
  table->enrichment_ph_post_injection_enabled = 1;
  table->enrichment_pp_sync_enabled = 1;
  table->enrichment_pp_async_enabled = 0;
  table->enrichment_pp_post_injection_enabled = 1;
  table->fuel_mass_per_cc = 0.75f;
  table->fuel_afr = 14.7f;

  table->enrichment_load_type = 0;
  table->enrichment_load_dead_band = 500.0f;
  table->enrichment_detect_duration = 100.0f;
  table->enrichment_ign_corr_decay_time = 200.0f;
  table->enrichment_injection_phase_decay_time = 200.0f;
  table->enrichment_async_pulses_divider = 5;
  table->enrichment_end_injection_final_phase = 540;
  table->enrichment_end_injection_final_amount = 1.0f;

  table->idle_valve_pos_min = -15;
  table->idle_valve_pos_max = 20;
  table->idle_throttle_pos_min = 0;
  table->idle_throttle_pos_max = 2;

  table->cylinders_count = ITEMSOF(default_cylinders);
  memcpy(table->cylinders, default_cylinders, sizeof(default_cylinders));

  table->voltages_count = ITEMSOF(default_voltages);
  memcpy(table->voltages, default_voltages, sizeof(default_voltages));

  table->pressures_count = ITEMSOF(default_pressures);
  memcpy(table->pressures, default_pressures, sizeof(default_pressures));

  table->rotates_count = ITEMSOF(default_rotates);
  memcpy(table->rotates, default_rotates, sizeof(default_rotates));

  table->idle_rotates_count = ITEMSOF(default_idle_rotates);
  memcpy(table->idle_rotates, default_idle_rotates, sizeof(default_idle_rotates));

  table->throttles_count = ITEMSOF(default_throttles);
  memcpy(table->throttles, default_throttles, sizeof(default_throttles));

  table->pedals_count = ITEMSOF(default_pedals);
  memcpy(table->pedals, default_pedals, sizeof(default_pedals));

  memcpy(table->filling_gbc_map, default_filling_gbc_map, sizeof(default_filling_gbc_map));
  memcpy(table->filling_gbc_tps, default_filling_gbc_tps, sizeof(default_filling_gbc_tps));
  memcpy(table->throttle_position, default_throttle_position, sizeof(default_throttle_position));
  memcpy(table->stop_throttle_position, default_stop_throttle_position, sizeof(default_stop_throttle_position));
  memcpy(table->throttle_position_1d, default_throttle_position_1d, sizeof(default_throttle_position_1d));
  memcpy(table->throttle_startup_move_time, default_throttle_startup_move_time, sizeof(default_throttle_startup_move_time));
  memcpy(table->filling_select_koff_tps, default_filling_select_koff_tps, sizeof(default_filling_select_koff_tps));
  table->throttle_position_use_1d = 1;

  table->enrichment_rate_start_load_count = ITEMSOF(default_enrichment_rate_start_load);
  memcpy(table->enrichment_rate_start_load, default_enrichment_rate_start_load, sizeof(default_enrichment_rate_start_load));
  table->enrichment_rate_load_derivative_count = ITEMSOF(default_enrichment_rate_load_derivative);
  memcpy(table->enrichment_rate_load_derivative, default_enrichment_rate_load_derivative, sizeof(default_enrichment_rate_load_derivative));

  memcpy(table->enrichment_rate, default_enrichment_rate, sizeof(default_enrichment_rate));
  memcpy(table->enrichment_accel_dead_band, default_enrichment_accel_dead_band, sizeof(default_enrichment_accel_dead_band));
  memcpy(table->enrichment_sync_amount, default_enrichment_sync_amount, sizeof(default_enrichment_sync_amount));
  memcpy(table->enrichment_async_amount, default_enrichment_async_amount, sizeof(default_enrichment_async_amount));
  memcpy(table->enrichment_ign_corr, default_enrichment_ign_corr, sizeof(default_enrichment_ign_corr));
  memcpy(table->enrichment_temp_mult, default_enrichment_temp_mult, sizeof(default_enrichment_temp_mult));
  memcpy(table->enrichment_injection_phase, default_enrichment_injection_phase, sizeof(default_enrichment_injection_phase));
  memcpy(table->enrichment_tps_selection, default_enrichment_tps_selection, sizeof(default_enrichment_tps_selection));

  table->fillings_count = ITEMSOF(default_fillings);
  memcpy(table->fillings, default_fillings, sizeof(default_fillings));

  memcpy(table->ignitions, default_ignitions, sizeof(default_ignitions));
  memset(table->ignition_corr_cy, 0, sizeof(table->ignition_corr_cy));
  memset(table->injection_corr_cy, 0, sizeof(table->injection_corr_cy));
  memcpy(table->fuel_mixtures, default_fuel_mixtures, sizeof(default_fuel_mixtures));
  memcpy(table->injection_phase, default_injection_phase, sizeof(default_injection_phase));

  memcpy(table->injection_phase_lpf, default_injection_phase_lpf, sizeof(default_injection_phase_lpf));
  memcpy(table->ignition_time_rpm_mult, default_ignition_time_rpm_mult, sizeof(default_ignition_time_rpm_mult));
  memcpy(table->ignition_time, default_ignition_time, sizeof(default_ignition_time));
  memcpy(table->injector_lag, default_injector_lag, sizeof(default_injector_lag));

  table->engine_temp_count = ITEMSOF(default_engine_temps);
  memcpy(table->engine_temps, default_engine_temps, sizeof(default_engine_temps));

  table->air_temp_count = ITEMSOF(default_air_temps);
  memcpy(table->air_temps, default_air_temps, sizeof(default_air_temps));
  memcpy(table->air_temp_mix_corr, default_air_temp_mix_corrs, sizeof(default_air_temp_mix_corrs));
  memcpy(table->air_temp_ign_corr, default_air_temp_ign_corrs, sizeof(default_air_temp_ign_corrs));
  memcpy(table->engine_temp_mix_corr, default_engine_temp_mix_corrs, sizeof(default_engine_temp_mix_corrs));
  memcpy(table->engine_temp_ign_corr, default_engine_temp_ign_corrs, sizeof(default_engine_temp_ign_corrs));

  memcpy(table->idle_wish_rotates, default_idle_wish_rotates, sizeof(default_idle_wish_rotates));
  memcpy(table->idle_wish_massair, default_idle_wish_massair, sizeof(default_idle_wish_massair));
  memcpy(table->idle_wish_ignition_static, default_idle_wish_ignition_static, sizeof(default_idle_wish_ignition_static));
  memcpy(table->idle_wish_ignition, default_idle_wish_ignition, sizeof(default_idle_wish_ignition));
  memcpy(table->idle_valve_position, default_idle_valve_position, sizeof(default_idle_valve_position));
  memcpy(table->idle_valve_econ_position, default_idle_valve_econ_position, sizeof(default_idle_valve_econ_position));
  memcpy(table->idle_throttle_position, default_idle_throttle_position, sizeof(default_idle_throttle_position));
  memcpy(table->idle_throttle_econ_position, default_idle_throttle_econ_position, sizeof(default_idle_throttle_econ_position));
  memcpy(table->pedal_ignition_control, default_pedal_ignition_control, sizeof(default_pedal_ignition_control));

  memcpy(table->warmup_mixtures, default_warmup_mixtures, sizeof(default_warmup_mixtures));
  memcpy(table->warmup_mix_koffs, default_warmup_mix_koffs, sizeof(default_warmup_mix_koffs));
  memcpy(table->warmup_mix_corrs, default_warmup_mix_corrs, sizeof(default_warmup_mix_corrs));

  memcpy(table->cold_start_idle_corrs, default_cold_start_idle_corrs, sizeof(default_cold_start_idle_corrs));
  memcpy(table->cold_start_idle_times, default_cold_start_idle_times, sizeof(default_cold_start_idle_times));
  memcpy(table->start_tps_corrs, default_start_tps_corrs, sizeof(default_start_tps_corrs));
  memcpy(table->start_async_filling, default_start_async_filling, sizeof(default_start_async_filling));
  memcpy(table->start_large_filling, default_start_large_filling, sizeof(default_start_large_filling));
  memcpy(table->start_small_filling, default_start_small_filling, sizeof(default_start_small_filling));
  memcpy(table->start_filling_time, default_start_filling_time, sizeof(default_start_filling_time));
  memcpy(table->start_ignition, default_start_ignition, sizeof(default_start_ignition));
  memcpy(table->start_injection_phase, default_start_injection_phase, sizeof(default_start_injection_phase));
  memcpy(table->start_idle_valve_pos, default_start_idle_valve_pos, sizeof(default_start_idle_valve_pos));
  memcpy(table->start_throttle_position, default_start_throttle_position, sizeof(default_start_throttle_position));
  table->start_large_count = 4;

  table->idle_pids_rpm_koffs_count = ITEMSOF(default_idle_pids_rpm_koffs);
  memcpy(table->idle_pids_rpm_koffs, default_idle_pids_rpm_koffs, sizeof(default_idle_pids_rpm_koffs));
  memcpy(table->idle_valve_to_massair_pid_p, default_idle_valve_to_massair_pid_p, sizeof(default_idle_valve_to_massair_pid_p));
  memcpy(table->idle_valve_to_massair_pid_i, default_idle_valve_to_massair_pid_i, sizeof(default_idle_valve_to_massair_pid_i));
  memcpy(table->idle_valve_to_massair_pid_d, default_idle_valve_to_massair_pid_d, sizeof(default_idle_valve_to_massair_pid_d));

  memcpy(table->idle_valve_to_rpm_pid_p, default_idle_valve_to_rpm_pid_p, sizeof(default_idle_valve_to_rpm_pid_p));
  memcpy(table->idle_valve_to_rpm_pid_i, default_idle_valve_to_rpm_pid_i, sizeof(default_idle_valve_to_rpm_pid_i));
  memcpy(table->idle_valve_to_rpm_pid_d, default_idle_valve_to_rpm_pid_d, sizeof(default_idle_valve_to_rpm_pid_d));

  memcpy(table->idle_throttle_to_massair_pid_p, default_idle_throttle_to_massair_pid_p, sizeof(default_idle_throttle_to_massair_pid_p));
  memcpy(table->idle_throttle_to_massair_pid_i, default_idle_throttle_to_massair_pid_i, sizeof(default_idle_throttle_to_massair_pid_i));
  memcpy(table->idle_throttle_to_massair_pid_d, default_idle_throttle_to_massair_pid_d, sizeof(default_idle_throttle_to_massair_pid_d));

  memcpy(table->idle_throttle_to_rpm_pid_p, default_idle_throttle_to_rpm_pid_p, sizeof(default_idle_throttle_to_rpm_pid_p));
  memcpy(table->idle_throttle_to_rpm_pid_i, default_idle_throttle_to_rpm_pid_i, sizeof(default_idle_throttle_to_rpm_pid_i));
  memcpy(table->idle_throttle_to_rpm_pid_d, default_idle_throttle_to_rpm_pid_d, sizeof(default_idle_throttle_to_rpm_pid_d));

  memcpy(table->idle_ign_to_rpm_pid_p, default_idle_ign_to_rpm_pid_p, sizeof(default_idle_ign_to_rpm_pid_p));
  memcpy(table->idle_ign_to_rpm_pid_i, default_idle_ign_to_rpm_pid_i, sizeof(default_idle_ign_to_rpm_pid_i));
  memcpy(table->idle_ign_to_rpm_pid_d, default_idle_ign_to_rpm_pid_d, sizeof(default_idle_ign_to_rpm_pid_d));

  memcpy(table->idle_rpm_pid_act_1, default_idle_rpm_pid_act_1, sizeof(default_idle_rpm_pid_act_1));
  memcpy(table->idle_rpm_pid_act_2, default_idle_rpm_pid_act_2, sizeof(default_idle_rpm_pid_act_2));

  table->short_term_corr_pid_p = 0.0000f;
  table->short_term_corr_pid_i = 0.0000f;
  table->short_term_corr_pid_d = 0.0000f;

  table->idle_ign_deviation_min = -10.0f;
  table->idle_ign_deviation_max = 12.0f;

  table->idle_ign_fan_low_corr = 0.6f;
  table->idle_ign_fan_high_corr = 1.2f;
  table->idle_air_fan_low_corr = 0.1f;
  table->idle_air_fan_high_corr = 0.2f;

  table->speeds_count = ITEMSOF(default_speeds);
  memcpy(table->speeds, default_speeds, sizeof(default_speeds));
  memcpy(table->idle_rpm_shift, default_idle_rpm_shift, sizeof(default_idle_rpm_shift));

  table->knock_ign_corr_max = -5.0f;
  table->knock_inj_corr_max = 0.00f;
  memcpy(table->knock_noise_level, default_knock_noise_level, sizeof(default_knock_noise_level));
  memcpy(table->knock_threshold, default_knock_threshold, sizeof(default_knock_threshold));
  memcpy(table->knock_zone, default_knock_zone, sizeof(default_knock_zone));
  memcpy(table->knock_gain, default_knock_gain, sizeof(default_knock_gain));
  memcpy(table->knock_filter_frequency, default_knock_filter_frequency, sizeof(default_knock_filter_frequency));
  memcpy(table->knock_cy_level_multiplier, default_knock_cy_level_multiplier, sizeof(default_knock_cy_level_multiplier));
  memcpy(table->knock_detect_phase_start, default_knock_detect_phase_start, sizeof(default_knock_detect_phase_start));
  memcpy(table->knock_detect_phase_end, default_knock_detect_phase_end, sizeof(default_knock_detect_phase_end));
  memcpy(table->knock_integrator_time, default_knock_integrator_time, sizeof(default_knock_integrator_time));

  memcpy(table->tsps_relative_pos, default_tsps_relative_pos, sizeof(default_tsps_relative_pos));
  memcpy(table->tsps_desync_thr, default_tsps_desync_thr, sizeof(default_tsps_desync_thr));
  memcpy(table->idle_ignition_time_by_tps, default_idle_ignition_time_by_tps, sizeof(default_idle_ignition_time_by_tps));
  memcpy(table->idle_econ_delay, default_idle_econ_delay, sizeof(default_idle_econ_delay));
  memcpy(table->start_econ_delay, default_start_econ_delay, sizeof(default_start_econ_delay));

  memcpy(table->dynamic_fuel_corr_gbc, default_dynamic_fuel_corr_gbc, sizeof(default_dynamic_fuel_corr_gbc));
  memcpy(table->dynamic_fuel_corr_temp, default_dynamic_fuel_corr_temp, sizeof(default_dynamic_fuel_corr_temp));
  memcpy(table->dynamic_fuel_corr_lpf, default_dynamic_fuel_corr_lpf, sizeof(default_dynamic_fuel_corr_lpf));

  table->fan_advance_control_low  = -0.20f;
  table->fan_advance_control_mid  =  0.00f;
  table->fan_advance_control_high =  0.20f;
  memcpy(table->fan_advance_control, default_fan_advance_control, sizeof(default_fan_advance_control));

  for(int i = 0; i < ECU_CYLINDERS_COUNT; i++) {
    table->cy_corr_injection[i] = 0;
    table->cy_corr_ignition[i] = 0;
  }
}

void config_default_params(sEcuParams *table)
{
  table->engineVolume = 1770.0f;

  table->isSwitchByExternal = 0;
  table->startupTableNumber = 0;
  table->switchPos1Table = 0;
  table->switchPos0Table = 0;
  table->switchPos2Table = 0;

  table->cutoffRPM = 7000;
  table->cutoffMode = 5;
  table->cutoffAdvance = 10.0f;
  table->cutoffMixture = 12.6f;
  table->oilPressureCutoffRPM = 2000;
  table->speedInputCorrection = 0.91f;
  table->speedOutputCorrection = 0.89f;

  table->useLambdaSensor = 1;
  table->phasedMode = 1;
  table->useKnockSensor = 1;
  table->performAdaptation = 1;
  table->performIdleAdaptation = 0;
  table->isSingleCoil = 0;
  table->isIndividualCoils = 0;
  table->isEconEnabled = 0;

  table->fanHighTemperature = 93;
  table->fanMidTemperature = 91;
  table->fanLowTemperature = 89;

  table->isBluetoothEnabled = 0;
  table->bluetoothPin = 1902;
  strcpy(table->bluetoothName, "BT_ECU");

  table->shiftMode = 0;
  table->shiftThrThr = 80;
  table->shiftRpmThr = 5000;
  table->shiftRpmTill = 2500;
  table->shiftAdvance = 3.0f;
  table->shiftMixture = 12.1f;

  table->useIdleValve = 0;
  table->useEtc = 1;
  table->etcPedalDeadZone = 0.0f;
  table->useShortTermCorr = 0;
  table->useLongTermCorr = 0;

  table->learn_cycles_delay_mult = 1.3f;
  table->air_temp_corr_koff_min = 0.8f;
  table->air_temp_corr_koff_max = 1.0f;

  table->tps_voltage_low = 1.320f;
  table->tps_voltage_high = 4.570f;

  table->map_pressure_gain = 19000.0f;
  table->map_pressure_offset = 10000.0f;

}

void config_transform_progress_to_corrections(sEcuCorrections *corrections, const sEcuCorrectionsProgress *progress)
{
  const float multiplier = 255.0f;

  if(!progress || !corrections) {
    return;
  }

  for(int y = 0; y < TABLE_FILLING_MAX; y++) {
    for(int x = 0; x < TABLE_ROTATES_MAX; x++) {
      float value = progress->progress_ignitions[y][x];
      if(value > 1.0f) value = 1.0f;
      corrections->progress_ignitions[y][x] = value * multiplier;
    }
  }
  for(int y = 0; y < TABLE_PRESSURES_MAX; y++) {
    for(int x = 0; x < TABLE_ROTATES_MAX; x++) {
      float value = progress->progress_filling_gbc_map[y][x];
      if(value > 1.0f) value = 1.0f;
      corrections->progress_filling_gbc_map[y][x] = value * multiplier;
    }
  }
  for(int y = 0; y < TABLE_THROTTLES_MAX; y++) {
    for(int x = 0; x < TABLE_ROTATES_MAX; x++) {
      float value = progress->progress_filling_gbc_tps[y][x];
      if(value > 1.0f) value = 1.0f;
      corrections->progress_filling_gbc_tps[y][x] = value * multiplier;
    }
  }
  for(int y = 0; y < TABLE_TEMPERATURES_MAX; y++) {
    float value = progress->progress_idle_valve_position[y];
    if(value > 1.0f) value = 1.0f;
    corrections->progress_idle_valve_position[y] = value * multiplier;
  }
  for(int y = 0; y < ECU_CYLINDERS_COUNT; y++) {
    for(int x = 0; x < TABLE_ROTATES_MAX; x++) {
      float value = progress->progress_knock_cy_level_multiplier[y][x];
      if(value > 1.0f) value = 1.0f;
      corrections->progress_knock_cy_level_multiplier[y][x] = value * multiplier;
    }
  }
}

void config_transform_corrections_to_progress(sEcuCorrectionsProgress *progress, const sEcuCorrections *corrections)
{
  const float multiplier = 1.0f / 255.0f;

  if(!progress || !corrections) {
    return;
  }

  for(int y = 0; y < TABLE_FILLING_MAX; y++) {
    for(int x = 0; x < TABLE_ROTATES_MAX; x++) {
      progress->progress_ignitions[y][x] = corrections->progress_ignitions[y][x] * multiplier;
    }
  }
  for(int y = 0; y < TABLE_PRESSURES_MAX; y++) {
    for(int x = 0; x < TABLE_ROTATES_MAX; x++) {
      progress->progress_filling_gbc_map[y][x] = corrections->progress_filling_gbc_map[y][x] * multiplier;
    }
  }
  for(int y = 0; y < TABLE_THROTTLES_MAX; y++) {
    for(int x = 0; x < TABLE_ROTATES_MAX; x++) {
      progress->progress_filling_gbc_tps[y][x] = corrections->progress_filling_gbc_tps[y][x] * multiplier;
    }
  }
  for(int y = 0; y < TABLE_TEMPERATURES_MAX; y++) {
    progress->progress_idle_valve_position[y] = corrections->progress_idle_valve_position[y] * multiplier;
  }
  for(int y = 0; y < ECU_CYLINDERS_COUNT; y++) {
    for(int x = 0; x < TABLE_ROTATES_MAX; x++) {
      progress->progress_knock_cy_level_multiplier[y][x] = corrections->progress_knock_cy_level_multiplier[y][x] * multiplier;
    }
  }
}

void config_default_corrections(sEcuCorrections *table)
{
  memset(table, 0, sizeof(sEcuCorrections));
}

void config_default_critical_backup(sEcuCriticalBackup *table)
{
  memset(table, 0, sizeof(sEcuCriticalBackup));
}

HAL_StatusTypeDef config_init(void)
{
  HAL_StatusTypeDef status = HAL_OK;
  status = flash_checkchip();
  return status;
}


int8_t config_load_table(sEcuTable *table, uint8_t number)
{
  if(number >= TABLE_SETUPS_MAX)
    return -1;
  return flash_page_load(table, sizeof(sEcuTable), CONFIG_OFFSET_TABLES + number);
}

int8_t config_save_table(const sEcuTable *table, uint8_t number)
{
  if(number >= TABLE_SETUPS_MAX)
    return -1;
  return flash_page_save(table, sizeof(sEcuTable), CONFIG_OFFSET_TABLES + number);
}


int8_t config_load_params(sEcuParams *params)
{
  return flash_page_load(params, sizeof(sEcuParams), CONFIG_OFFSET_PARAMS);
}

int8_t config_save_params(const sEcuParams *params)
{
  return flash_page_save(params, sizeof(sEcuParams), CONFIG_OFFSET_PARAMS);
}

int8_t config_load_corrections(sEcuCorrections *table)
{
  return flash_page_load(table, sizeof(sEcuCorrections), CONFIG_OFFSET_CORRECTIONS);
}

int8_t config_save_corrections(const sEcuCorrections *table)
{
  return flash_page_save(table, sizeof(sEcuCorrections), CONFIG_OFFSET_CORRECTIONS);
}

int8_t config_load_critical_backup(sEcuCriticalBackup *table)
{
  return flash_bkpsram_load(table, sizeof(sEcuCriticalBackup), CONFIG_OFFSET_CRITICALS);
}

int8_t config_save_critical_backup(const sEcuCriticalBackup *table)
{
  return flash_bkpsram_save(table, sizeof(sEcuCriticalBackup), CONFIG_OFFSET_CRITICALS);
}

int8_t config_load_all(sEcuParams *params, sEcuTable *tables, uint32_t tables_count)
{
  static uint8_t state = 0;
  static int8_t current_table = 0;
  static int8_t tables_left = 0;
  int8_t status;

  if(!tables_count)
	  return -1;

  switch(state) {
    case 0 :
      status = config_load_params(params);
      if(status) {
        if(status > 0) {
          current_table = 0;
          tables_left = tables_count;
          state++;
        } else {
          state = 0;
          return -1;
        }
      }
      break;
    case 1 :
      status = config_load_table(&tables[current_table], current_table);
      if(status) {
        if(status > 0) {
          tables_left--;
          if(tables_left) {
            current_table++;
          } else {
            current_table = 0;
            state = 0;
            return 1;
          }
        } else {
          state = 0;
          current_table = 0;
          return -2;
        }
      }
      break;
    default:
      state = 0;
      break;
  }
  return 0;
}

int8_t config_save_all(const sEcuParams *params, const sEcuCorrections *corrections, const sEcuTable *tables, uint32_t tables_count)
{
  static uint8_t state = 0;
  static int8_t current_table = 0;
  static int8_t tables_left = 0;

  if(!tables_count)
	  return -1;

  int8_t status;
  switch(state) {
    case 0 :
      status = config_save_params(params);
      if(status) {
        if(status > 0) {
          state++;
        } else {
          state = 0;
          return -1;
        }
      }
      break;
    case 1 :
      status = config_save_corrections(corrections);
      if(status) {
        if(status > 0) {
          current_table = 0;
          tables_left = tables_count;
          state++;
        } else {
          state = 0;
          return -2;
        }
      }
      break;
    case 2 :
      status = config_save_table(&tables[current_table], current_table);
      if(status) {
        if(status > 0) {
          tables_left--;
          if(tables_left) {
            current_table++;
          } else {
            current_table = 0;
            state = 0;
            return 1;
          }
        } else {
          state = 0;
          current_table = 0;
          return -3;
        }
      }
      break;
    default:
      state = 0;
      break;
  }
  return 0;
}
